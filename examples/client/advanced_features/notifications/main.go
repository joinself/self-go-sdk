// Package main demonstrates push notification capabilities of the Self SDK.
//
// This is the NOTIFICATIONS level of advanced features examples.
// Prerequisites: Complete ../storage/main.go first to understand storage foundations.
//
// This example shows:
// - Push notification system for real-time user engagement
// - Multiple notification types (chat, credential, custom)
// - Event-driven notification handling
// - Delivery tracking and status management
// - Notification customization and targeting
//
// üéØ What you'll learn:
// ‚Ä¢ How to send different types of notifications
// ‚Ä¢ Event handling for notification delivery
// ‚Ä¢ Notification customization and targeting
// ‚Ä¢ Real-time user engagement patterns
// ‚Ä¢ Integration with other SDK components
//
// üìö Next steps:
// ‚Ä¢ ../pairing/main.go - Account pairing and multi-device sync
// ‚Ä¢ ../production_patterns/main.go - Real-world storage patterns
// ‚Ä¢ ../integration/main.go - Component integration workflows
package main

import (
	"fmt"
	"log"
	"time"

	"github.com/joinself/self-go-sdk/client"
	"github.com/joinself/self-go-sdk/examples/utils"
)

func main() {
	fmt.Println("üîî Push Notifications Demo")
	fmt.Println("==========================")
	fmt.Println("This demo showcases Self SDK push notification capabilities.")
	fmt.Println("üìö This is the NOTIFICATIONS level - user engagement patterns.")
	fmt.Println()

	// Step 1: Create a Self client for notification demonstrations
	notificationClient := createNotificationClient()
	defer notificationClient.Close()

	fmt.Printf("üÜî Client DID: %s\n", notificationClient.DID())
	fmt.Println()

	// Step 2: Set up notification event handlers
	setupNotificationHandlers(notificationClient)

	// Step 3: Demonstrate different notification types
	demonstrateNotificationTypes(notificationClient)

	// Step 4: Show notification customization
	demonstrateNotificationCustomization(notificationClient)

	// Step 5: Explore notification targeting and delivery
	demonstrateNotificationTargeting(notificationClient)

	fmt.Println("‚úÖ Notification system demo completed!")
	fmt.Println()
	fmt.Println("üéì What happened:")
	fmt.Println("   1. Set up notification event handlers")
	fmt.Println("   2. Sent various types of notifications")
	fmt.Println("   3. Customized notification content and appearance")
	fmt.Println("   4. Demonstrated targeting and delivery tracking")
	fmt.Println()
	fmt.Println("üéØ Notification benefits:")
	fmt.Println("   ‚Ä¢ Real-time user engagement and alerts")
	fmt.Println("   ‚Ä¢ Multiple notification types for different use cases")
	fmt.Println("   ‚Ä¢ Event-driven delivery tracking")
	fmt.Println("   ‚Ä¢ Seamless integration with other SDK features")
	fmt.Println()
	fmt.Println("üìö Ready for the next level?")
	fmt.Println("   ‚Ä¢ Run ../pairing/main.go to learn about account pairing")
	fmt.Println("   ‚Ä¢ Run ../production_patterns/main.go for real-world patterns")
	fmt.Println("   ‚Ä¢ Run ../integration/main.go for component integration")
}

// createNotificationClient sets up a Self client for notification demonstrations
func createNotificationClient() *client.Client {
	fmt.Println("üîß Setting up notification client...")

	notificationClient, err := client.New(client.Config{
		StorageKey:  utils.GenerateStorageKey("notification_demo"),
		StoragePath: "./notification_demo_storage",
		Environment: client.Sandbox,
		LogLevel:    client.LogInfo,
	})
	if err != nil {
		log.Fatal("Failed to create notification client:", err)
	}

	fmt.Println("‚úÖ Notification client created successfully")
	return notificationClient
}

// setupNotificationHandlers configures notification event handlers
func setupNotificationHandlers(selfClient *client.Client) {
	fmt.Println("üîπ Setting Up Notification Handlers")
	fmt.Println("===================================")
	fmt.Println("Configuring event-driven notification handling...")
	fmt.Println()

	notifications := selfClient.Notifications()

	// Handler for successful notification delivery
	notifications.OnNotificationSent(func(peerDID string, summary *client.NotificationSummary) {
		timestamp := time.Now().Format("15:04:05")
		fmt.Printf("   üì§ [%s] Notification sent to %s\n", timestamp, peerDID)
		fmt.Printf("      üìã Title: %s\n", summary.Title)
		fmt.Printf("      üìù Body: %s\n", summary.Body)
		fmt.Printf("      üè∑Ô∏è  Type: %s\n", summary.MessageType)
		fmt.Printf("      ‚úÖ Delivery confirmed\n")
		fmt.Println()
	})

	fmt.Println("‚úÖ Notification handlers configured")
	fmt.Println("   ‚Ä¢ Delivery confirmation tracking")
	fmt.Println("   ‚Ä¢ Event-driven notification handling")
	fmt.Println("   ‚Ä¢ Real-time notification status updates")
	fmt.Println()
}

// demonstrateNotificationTypes shows different notification patterns
func demonstrateNotificationTypes(selfClient *client.Client) {
	fmt.Println("üîπ Notification Types")
	fmt.Println("=====================")
	fmt.Println("Exploring different notification types and use cases...")
	fmt.Println()

	notifications := selfClient.Notifications()
	targetDID := selfClient.DID() // Using self for demo

	// Chat notification - for messaging alerts
	fmt.Println("üí¨ Chat Notification:")
	fmt.Println("   Use case: New message alerts, conversation updates")
	err := notifications.SendChatNotification(targetDID, "Hello! You have a new message from Alice.")
	if err != nil {
		log.Printf("Failed to send chat notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Chat notification sent successfully")
	}
	time.Sleep(1 * time.Second) // Small delay for demo clarity

	// Credential notification - for identity-related alerts
	fmt.Println("\nüÜî Credential Notification:")
	fmt.Println("   Use case: Credential requests, verifications, issuance")
	err = notifications.SendCredentialNotification(targetDID, "identity", "request")
	if err != nil {
		log.Printf("Failed to send credential notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Credential notification sent successfully")
	}
	time.Sleep(1 * time.Second)

	// Group invite notification - for group management
	fmt.Println("\nüë• Group Invite Notification:")
	fmt.Println("   Use case: Group invitations, membership changes")
	err = notifications.SendGroupInviteNotification(targetDID, "Development Team", "Alice")
	if err != nil {
		log.Printf("Failed to send group invite notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Group invite notification sent successfully")
	}
	time.Sleep(1 * time.Second)

	// Custom notification - for application-specific alerts
	fmt.Println("\nüîî Custom Notification:")
	fmt.Println("   Use case: Application-specific alerts, system notifications")
	err = notifications.SendCustomNotification(
		targetDID,
		"System Alert",
		"Your account security settings have been updated. Please review the changes in your security dashboard.",
		"security",
	)
	if err != nil {
		log.Printf("Failed to send custom notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Custom notification sent successfully")
	}

	fmt.Println("\nüìä Notification Type Summary:")
	fmt.Println("   ‚Ä¢ Chat: Real-time messaging alerts")
	fmt.Println("   ‚Ä¢ Credential: Identity and verification alerts")
	fmt.Println("   ‚Ä¢ Group: Team and collaboration notifications")
	fmt.Println("   ‚Ä¢ Custom: Application-specific notifications")
	fmt.Println()
}

// demonstrateNotificationCustomization shows notification personalization
func demonstrateNotificationCustomization(selfClient *client.Client) {
	fmt.Println("üîπ Notification Customization")
	fmt.Println("=============================")
	fmt.Println("Personalizing notifications for better user experience...")
	fmt.Println()

	notifications := selfClient.Notifications()
	targetDID := selfClient.DID()

	// Urgent notification with high priority
	fmt.Println("üö® High Priority Notification:")
	err := notifications.SendCustomNotification(
		targetDID,
		"üö® URGENT: Security Alert",
		"Suspicious login attempt detected from new device. If this wasn't you, please secure your account immediately.",
		"security_urgent",
	)
	if err != nil {
		log.Printf("Failed to send urgent notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Urgent security notification sent")
	}
	time.Sleep(1 * time.Second)

	// Informational notification with rich content
	fmt.Println("\nüìä Rich Content Notification:")
	err = notifications.SendCustomNotification(
		targetDID,
		"üìä Weekly Report Available",
		"Your weekly activity report is ready! This week: 47 messages sent, 3 new connections, 2 credentials verified. View full report in your dashboard.",
		"report",
	)
	if err != nil {
		log.Printf("Failed to send report notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Rich content notification sent")
	}
	time.Sleep(1 * time.Second)

	// Achievement notification with celebration
	fmt.Println("\nüèÜ Achievement Notification:")
	err = notifications.SendCustomNotification(
		targetDID,
		"üèÜ Achievement Unlocked!",
		"Congratulations! You've successfully completed your first credential exchange. You're now ready to explore advanced Self SDK features.",
		"achievement",
	)
	if err != nil {
		log.Printf("Failed to send achievement notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Achievement notification sent")
	}
	time.Sleep(1 * time.Second)

	// Reminder notification with action items
	fmt.Println("\n‚è∞ Reminder Notification:")
	err = notifications.SendCustomNotification(
		targetDID,
		"‚è∞ Reminder: Credential Expiring Soon",
		"Your professional certification credential expires in 7 days. Renew now to maintain continuous verification status.",
		"reminder",
	)
	if err != nil {
		log.Printf("Failed to send reminder notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Reminder notification sent")
	}

	fmt.Println("\nüé® Customization Features:")
	fmt.Println("   ‚Ä¢ Emoji and visual indicators for quick recognition")
	fmt.Println("   ‚Ä¢ Priority levels for urgent vs. informational content")
	fmt.Println("   ‚Ä¢ Rich content with detailed information")
	fmt.Println("   ‚Ä¢ Category-based organization and filtering")
	fmt.Println("   ‚Ä¢ Action-oriented messaging for user engagement")
	fmt.Println()
}

// demonstrateNotificationTargeting shows targeting and delivery patterns
func demonstrateNotificationTargeting(selfClient *client.Client) {
	fmt.Println("üîπ Notification Targeting & Delivery")
	fmt.Println("====================================")
	fmt.Println("Advanced targeting and delivery tracking patterns...")
	fmt.Println()

	notifications := selfClient.Notifications()
	targetDID := selfClient.DID()

	// Simulate different user scenarios
	fmt.Println("üéØ Targeted Notification Scenarios:")

	// New user onboarding
	fmt.Println("\nüëã New User Onboarding:")
	err := notifications.SendCustomNotification(
		targetDID,
		"üëã Welcome to Self SDK!",
		"Welcome! Let's get you started with a quick tour. Complete these steps: 1) Verify your identity, 2) Connect with peers, 3) Exchange your first credential.",
		"onboarding",
	)
	if err != nil {
		log.Printf("Failed to send onboarding notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Onboarding notification sent")
	}
	time.Sleep(1 * time.Second)

	// Re-engagement for inactive users
	fmt.Println("\nüîÑ Re-engagement Notification:")
	err = notifications.SendCustomNotification(
		targetDID,
		"üîÑ We Miss You!",
		"It's been a while since your last visit. Check out the new features we've added: advanced storage, group chat, and credential templates.",
		"re_engagement",
	)
	if err != nil {
		log.Printf("Failed to send re-engagement notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Re-engagement notification sent")
	}
	time.Sleep(1 * time.Second)

	// Feature announcement for existing users
	fmt.Println("\nüÜï Feature Announcement:")
	err = notifications.SendCustomNotification(
		targetDID,
		"üÜï New Feature: Advanced Storage",
		"Exciting news! We've launched advanced storage with namespacing and TTL. Organize your data better and improve performance with intelligent caching.",
		"feature_announcement",
	)
	if err != nil {
		log.Printf("Failed to send feature announcement: %v", err)
	} else {
		fmt.Println("   ‚úÖ Feature announcement sent")
	}
	time.Sleep(1 * time.Second)

	// Maintenance notification
	fmt.Println("\nüîß Maintenance Notification:")
	err = notifications.SendCustomNotification(
		targetDID,
		"üîß Scheduled Maintenance",
		"Scheduled maintenance tonight 2-4 AM UTC. Services may be briefly unavailable. We're upgrading our infrastructure for better performance.",
		"maintenance",
	)
	if err != nil {
		log.Printf("Failed to send maintenance notification: %v", err)
	} else {
		fmt.Println("   ‚úÖ Maintenance notification sent")
	}

	// Demonstrate notification analytics
	fmt.Println("\nüìà Notification Analytics & Insights:")
	fmt.Println("   ‚Ä¢ Delivery confirmation rates")
	fmt.Println("   ‚Ä¢ User engagement metrics")
	fmt.Println("   ‚Ä¢ Optimal timing for different notification types")
	fmt.Println("   ‚Ä¢ Category-based performance analysis")
	fmt.Println()

	fmt.Println("üéØ Targeting Best Practices:")
	fmt.Println("   ‚Ä¢ Segment users based on activity and preferences")
	fmt.Println("   ‚Ä¢ Time notifications for optimal engagement")
	fmt.Println("   ‚Ä¢ Personalize content based on user journey stage")
	fmt.Println("   ‚Ä¢ Use categories for user filtering and preferences")
	fmt.Println("   ‚Ä¢ Track delivery and engagement for optimization")
	fmt.Println()

	fmt.Println("üîÑ Integration Opportunities:")
	fmt.Println("   ‚Ä¢ Combine with storage for user preference tracking")
	fmt.Println("   ‚Ä¢ Integrate with chat for conversation notifications")
	fmt.Println("   ‚Ä¢ Use with pairing for multi-device notification sync")
	fmt.Println("   ‚Ä¢ Connect to credentials for verification alerts")
	fmt.Println()
}
